<div class="container"></div>
<header id="carouselContainer">
    <!-- Carousel will be rendered here -->
</header>
<div id="mainSection"></div>
<div class="container" style="margin-top: 20px;">
  <div id="sectionImage"></div>
  <!-- Modal galery image -->
</div>
<script>

document.addEventListener('DOMContentLoaded', function() {
    // Nazwa pliku JSON, który chcesz załadować
    const fileName = 'galeria.json'; // Możesz tutaj ustawić dynamiczną nazwę pliku, jeśli to potrzebne

    // Pobierz dane z serwera
    fetch(`/get-json?file=${fileName}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(jsonData => {
            // Przypisz dane do zmiennej globalnej
            data = jsonData;
            console.log('Dane wczytane:', data);

            // Wywołaj funkcje renderujące HTML po załadowaniu danych
            renderContent(data);
        })
        .catch(error => {
            console.error('Błąd:', error);
        });
});

function renderHeaderVideo(data) {
    const carouselIndicators = data.carouselItems.map((item, index) => {
        return `<li data-mdb-target="#introCarousel" data-mdb-slide-to="${index}" ${index === 0 ? 'class="active"' : ''}></li>`;
    }).join('');

    const carouselItems = data.carouselItems.map((item, index) => {
        const buttons = item.buttons ? item.buttons.map(button => {
            return `<a class="btn ${button.class} btn-lg m-2" href="${button.url}" target="_blank" role="button">${button.text}</a>`;
        }).join('') : '';

        const heading = item.heading ? `<h1 class="mb-3 custom-text-white">${item.heading}</h1>` : '';
        const subheading = item.subheading ? `<h5 class="mb-4 custom-text-white">${item.subheading}</h5>` : '';

        return `
            <div class="carousel-item ${index === 0 ? 'active' : ''}">
                <video style="min-width: 100%; min-height: 100%" playsinline autoplay muted loop>
                    <source class="h-100" src="${item.videoSrc}" type="video/mp4" />
                </video>
                <div class="mask" style="background-color: ${item.maskColor}">
                    <div class="d-flex justify-content-center align-items-center h-100">
                        <div class="text-white text-center">
                            ${heading}
                            ${subheading}
                            ${buttons}
                        </div>
                    </div>
                </div>
            </div>
        `;
    }).join('');

    return `
        <div id="introCarousel" class="carousel slide carousel-fade shadow-2-strong" data-mdb-ride="carousel">
            <ol class="carousel-indicators">
                ${carouselIndicators}
            </ol>
            <div class="carousel-inner">
                ${carouselItems}
            </div>
            <a class="carousel-control-prev" href="#introCarousel" role="button" data-mdb-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#introCarousel" role="button" data-mdb-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    `;
}

document.addEventListener('DOMContentLoaded', function() {
    // Pobierz przycisk
    var button = document.querySelector('[id="telefon"]');
    // Ustaw zdarzenie na kliknięcie przycisku
    button.addEventListener('click', function() {
        // Ustaw numer telefonu
        var phoneNumber = "567 874 992"; // Skoro dane nie są jeszcze załadowane, używam wartości statycznej
        // Wstaw numer telefonu wewnątrz przycisku
        button.textContent = phoneNumber;

        // Po 5 sekundach przywróć oryginalny tekst przycisku
        setTimeout(function() {
            button.textContent = data.mainSection.button1Text; // Zmieniono na prawidłowy dostęp do zmiennej data
        }, 5000);
    });
});

function generateMainSectionHTML(data) {
    return `
    <div data-draggable="false" style="position: relative;">
        <section draggable="false" class="overflow-hidden pt-0" data-v-271253ee="">
            <section class="mb-10">
                <!-- Background image -->
                <div class="p-5 text-center bg-image" style="background-image: url('${data.mainSection.backgroundURL}'); height: 500px; background-size: cover; background-position: 50% 50%; background-color: rgba(0, 0, 0, 0);" data-builder-edit="background" data-builder-name="background1" aria-controls="#picker-editor"></div>
                <!-- Background image -->
                <div class="container">
                    <div class="card mx-4 mx-md-5 text-center shadow-5-strong" style=" margin-top: -170px; background: hsla(0, 0%, 100%, 0.7); backdrop-filter: blur(30px); ">
                        <div class="card-body px-4 py-5 px-md-5">
                            <h1 class="display-3 fw-bold ls-tight mb-4">
                                <span data-builder-edit="text" data-builder-name="text1" contenteditable="false">${data.mainSection.title1}</span>
                                <br>
                                <span class="text-primary" data-builder-edit="text" data-builder-name="text2" contenteditable="false">${data.mainSection.title2}</span>
                            </h1>
                            <a class="btn btn-primary btn-lg py-3 px-5 mb-2 mb-md-0 me-md-2" id="telefon" role="button" data-builder-edit="button" data-builder-name="button1" aria-controls="#picker-editor">${data.mainSection.button1Text}</a>
                            <a class="btn btn-link btn-lg py-3 px-5 mb-2 mb-md-0" data-ripple-color="primary" href="oferta" role="button" data-builder-edit="button" data-builder-name="button2" aria-controls="#picker-editor">${data.mainSection.button2Text}</a>
                        </div>
                    </div>
                </div>
            </section>
        </section>
    </div>
    `;
}

function renderSectionImage() {
    let container = '<div class="container" style="margin-top: 20px;">';

    for (let i = 0; i < data.sectionImage.length; i += 3) { // Zmieniono "dane" na "data"
        container += '<div class="row">';

        for (let j = 0; j < 3; j++) {
            if (i + j < data.sectionImage.length) { // Zmieniono "dane" na "data"
                const image = data.sectionImage[i + j]; // Zmieniono "dane" na "data"
                container += `
                <div class="col-lg-4 col-md-6 mb-4">
                    <img
                    src="${image.src}"
                    class="img-fluid shadow-1-strong rounded"
                    data-mdb-animation-init
                    data-mdb-toggle="animation"
                    data-mdb-animation-start="onScroll"
                    data-mdb-animation="fade-in"
                    ${image.animationDelay ? `data-mdb-animation-delay="${image.animationDelay}"` : ''}
                    onclick="openModal(${i + j})"
                    style="cursor: pointer;"
                    />
                </div>
                `;
            }
        }

        container += '</div>';
    }

    container += '</div>';
    return container;
}

function renderModal() {
    return `
        <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-body">
                <!--- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>  ---!>
                <img id="modalImage" src="" class="img-fluid" alt="Full Size Image">
                <a class="carousel-control-prev" href="#" role="button" onclick="prevImage()">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#" role="button" onclick="nextImage()">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="sr-only">Next</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      `;
}

let currentIndex = 0;

function openModal(index) {
    currentIndex = index;
    document.getElementById('modalImage').src = data.sectionImage[currentIndex].src; // Zmieniono "dane" na "data"
    $('#imageModal').modal('show');
}

function prevImage() {
    currentIndex = (currentIndex > 0) ? currentIndex - 1 : data.sectionImage.length - 1; // Zmieniono "dane" na "data"
    document.getElementById('modalImage').src = data.sectionImage[currentIndex].src; // Zmieniono "dane" na "data"
}

function nextImage() {
    currentIndex = (currentIndex < data.sectionImage.length - 1) ? currentIndex + 1 : 0; // Zmieniono "dane" na "data"
    document.getElementById('modalImage').src = data.sectionImage[currentIndex].src; // Zmieniono "dane" na "data"
} 

function renderContent(data) {
    // Renderuj karuzelę wideo i dodaj ją do kontenera
   // const carouselHTML = renderHeaderVideo(data);
   // document.getElementById('carouselContainer').innerHTML = carouselHTML;

    // Renderuj sekcję główną i dodaj ją do sekcji głównej
    const mainSectionHTML = generateMainSectionHTML(data);
    document.getElementById('mainSection').innerHTML = mainSectionHTML;

    // Renderuj obrazy i modal, a następnie dodaj je do kontenera obrazów
    const sectionImageHTML = renderSectionImage();
    const modalHTML = renderModal();
    document.getElementById('sectionImage').innerHTML = sectionImageHTML + modalHTML;
}

// Przykład wywołania funkcji (powinno być już wywołane po załadowaniu danych)
//renderContent(data);

</script>
