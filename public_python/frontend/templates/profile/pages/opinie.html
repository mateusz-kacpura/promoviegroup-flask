<!doctype html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edytuj Opinie</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Dodatkowy styl dla lepszej czytelności */
        .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: white;
        }
        .tab-content {
            border: 1px solid #dee2e6;
            border-top: 0;
            padding: 20px;
        }
        .remove-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
        .remove-btn:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
    {% include 'profile/navbar.html' %}
    <div class="container mt-5">
        <h1>Edytuj Opinie</h1>
        <form action="{{ url_for('user.update_opinie') }}" method="POST" enctype="multipart/form-data">
            <!-- Zakładki (Tabs) -->
            <ul class="nav nav-tabs" id="editTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="hero-tab" data-bs-toggle="tab" href="#hero" role="tab" aria-controls="hero" aria-selected="true">Hero</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="about-tab" data-bs-toggle="tab" href="#about" role="tab" aria-controls="about" aria-selected="false">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="clients-tab" data-bs-toggle="tab" href="#clients" role="tab" aria-controls="clients" aria-selected="false">Clients</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="testimonials-tab" data-bs-toggle="tab" href="#testimonials" role="tab" aria-controls="testimonials" aria-selected="false">Testimonials</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="about-us-tab" data-bs-toggle="tab" href="#about-us" role="tab" aria-controls="about-us" aria-selected="false">About Us</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="contact-tab" data-bs-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Contact</a>
                </li>
            </ul>

            <div class="tab-content" id="editTabContent">
                <!-- Hero Section -->
                <div class="tab-pane fade show active" id="hero" role="tabpanel" aria-labelledby="hero-tab">
                    <h2>Hero Section</h2>
                    <div class="mb-3">
                        <label for="heroBackgroundImage" class="form-label">Tło (URL do obrazu)</label>
                        <input type="text" class="form-control" id="heroBackgroundImage" name="hero[backgroundImage]" value="{{ data.hero.backgroundImage }}">
                    </div>
                    <div class="mb-3">
                        <label for="heroTitle" class="form-label">Tytuł</label>
                        <input type="text" class="form-control" id="heroTitle" name="hero[title]" value="{{ data.hero.title }}">
                    </div>
                    <div class="mb-3">
                        <label for="heroDescription" class="form-label">Opis</label>
                        <textarea class="form-control" id="heroDescription" name="hero[description]" rows="3">{{ data.hero.description }}</textarea>
                    </div>
                </div>

                <!-- About Section -->
                <div class="tab-pane fade" id="about" role="tabpanel" aria-labelledby="about-tab">
                    <h2>About Section</h2>
                    <div class="mb-3">
                        <label for="aboutTitle" class="form-label">Tytuł</label>
                        <input type="text" class="form-control" id="aboutTitle" name="about[title]" value="{{ data.about.title }}">
                    </div>
                    <div class="mb-3">
                        <label for="aboutDescription" class="form-label">Opis</label>
                        <textarea class="form-control" id="aboutDescription" name="about[description]" rows="3">{{ data.about.description }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="aboutButtonText" class="form-label">Tekst Przycisku</label>
                        <input type="text" class="form-control" id="aboutButtonText" name="about[buttonText]" value="{{ data.about.buttonText }}">
                    </div>
                    <div class="mb-3">
                        <label for="aboutImage1" class="form-label">Obraz 1 (URL)</label>
                        <input type="text" class="form-control" id="aboutImage1" name="about[image1]" value="{{ data.about.image1 }}">
                    </div>
                    <div class="mb-3">
                        <label for="aboutImage2" class="form-label">Obraz 2 (URL)</label>
                        <input type="text" class="form-control" id="aboutImage2" name="about[image2]" value="{{ data.about.image2 }}">
                    </div>
                </div>

                <!-- Clients Section -->
                <div class="tab-pane fade" id="clients" role="tabpanel" aria-labelledby="clients-tab">
                    <h2>Clients Section</h2>
                    <div id="clients-list">
                        {% for i in range(data.clients|length) %}
                        <div class="mb-3 client-item">
                            <label for="client{{ i }}" class="form-label">Logo Klienta {{ i+1 }} (URL)</label>
                            <input type="text" class="form-control" id="client{{ i }}" name="clients[{{ i }}]" value="{{ data.clients[i] }}">
                            <button type="button" class="remove-btn" onclick="removeClient(this)">Usuń</button>
                        </div>
                        {% endfor %}
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addClient()">Dodaj Klienta</button>
                </div>
                
                <!-- Testimonials Section -->
                <div class="tab-pane fade" id="testimonials" role="tabpanel" aria-labelledby="testimonials-tab">
                    <h2>Testimonials</h2>
                    <div id="testimonials-list">
                        <!-- Tutaj będą ładowane opinie przez AJAX -->
                    </div>
                
                    <!-- Paginacja -->
                    <nav aria-label="Testimonials pagination">
                        <ul class="pagination">
                            <li class="page-item">
                                <a class="page-link" href="#" id="prevPage" onclick="changePage(-1)">Poprzednia</a>
                            </li>
                            <li class="page-item disabled">
                                <span class="page-link" id="pagination-info"></span>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#" id="nextPage" onclick="changePage(1)">Następna</a>
                            </li>
                        </ul>
                    </nav>
                
                    <button type="button" class="btn btn-secondary" onclick="addTestimonial()">Dodaj Opinię</button>
                </div>

                <!-- Kontynuacja kodu -->
                <!-- About Us Section -->
                <div class="tab-pane fade" id="about-us" role="tabpanel" aria-labelledby="about-us-tab">
                    <h2>About Us</h2>
                    <div class="mb-3">
                        <label for="aboutUsVideoSrc" class="form-label">Video URL</label>
                        <input type="text" class="form-control" id="aboutUsVideoSrc" name="aboutUs[videoSrc]" value="{{ data.aboutUs.videoSrc }}">
                    </div>
                    <div class="mb-3">
                        <label for="aboutUsTitle" class="form-label">Tytuł</label>
                        <input type="text" class="form-control" id="aboutUsTitle" name="aboutUs[title]" value="{{ data.aboutUs.title }}">
                    </div>
                    <div class="mb-3">
                        <label for="aboutUsDescription" class="form-label">Opis</label>
                        <textarea class="form-control" id="aboutUsDescription" name="aboutUs[description]" rows="3">{{ data.aboutUs.description }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="aboutUsImage" class="form-label">Obraz (URL)</label>
                        <input type="text" class="form-control" id="aboutUsImage" name="aboutUs[image]" value="{{ data.aboutUs.image }}">
                    </div>
                    <div id="aboutUsPointsList">
                        {% for i in range(data.aboutUs.points|length) %}
                        <div class="mb-3 about-us-point-item">
                            <label for="aboutUsPoint{{ i }}" class="form-label">Punkt {{ i+1 }}</label>
                            <input type="text" class="form-control" id="aboutUsPoint{{ i }}" name="aboutUs[points][{{ i }}]" value="{{ data.aboutUs.points[i] }}">
                            <button type="button" class="remove-btn" onclick="removeAboutUsPoint(this)">Usuń</button>
                        </div>
                        {% endfor %}
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addAboutUsPoint()">Dodaj Punkt</button>
                </div>

                <!-- Contact Section -->
                <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                    <h2>Contact</h2>
                    
                    <!-- Background Image -->
                    <div class="mb-3">
                        <label for="contactBackgroundImage" class="form-label">Background Image URL</label>
                        <input type="text" class="form-control" id="contactBackgroundImage" name="contact[backgroundImage]" value="{{ data.contact.backgroundImage }}">
                    </div>

                    <!-- Title -->
                    <div class="mb-3">
                        <label for="contactTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="contactTitle" name="contact[title]" value="{{ data.contact.title }}">
                    </div>

                    <!-- Button Link -->
                    <div class="mb-3">
                        <label for="contactButtonLink" class="form-label">Button Link</label>
                        <input type="text" class="form-control" id="contactButtonLink" name="contact[buttonLink]" value="{{ data.contact.buttonLink }}">
                    </div>

                    <!-- Button Text -->
                    <div class="mb-3">
                        <label for="contactButtonText" class="form-label">Button Text</label>
                        <input type="text" class="form-control" id="contactButtonText" name="contact[buttonText]" value="{{ data.contact.buttonText }}">
                    </div>

                    <!-- Email -->
                    <div class="mb-3">
                        <label for="contactEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="contactEmail" name="contact[email]" value="{{ data.contact.email }}">
                    </div>

                    <!-- Phone -->
                    <div class="mb-3">
                        <label for="contactPhone" class="form-label">Telefon</label>
                        <input type="text" class="form-control" id="contactPhone" name="contact[phone]" value="{{ data.contact.phone }}">
                    </div>

                    <!-- Address -->
                    <div class="mb-3">
                        <label for="contactAddress" class="form-label">Adres</label>
                        <input type="text" class="form-control" id="contactAddress" name="contact[address]" value="{{ data.contact.address }}">
                    </div>

                    <!-- Google Maps URL -->
                    <div class="mb-3">
                        <label for="contactMapUrl" class="form-label">Google Maps URL</label>
                        <input type="text" class="form-control" id="contactMapUrl" name="contact[mapUrl]" value="{{ data.contact.mapUrl }}">
                    </div>

                    <!-- Facebook URL -->
                    <div class="mb-3">
                        <label for="contactFacebook" class="form-label">Facebook (URL)</label>
                        <input type="text" class="form-control" id="contactFacebook" name="contact[social][facebook]" value="{{ data.contact.social.facebook }}">
                    </div>

                    <!-- LinkedIn URL -->
                    <div class="mb-3">
                        <label for="contactLinkedin" class="form-label">LinkedIn (URL)</label>
                        <input type="text" class="form-control" id="contactLinkedin" name="contact[social][linkedin]" value="{{ data.contact.social.linkedin }}">
                    </div>

                    <!-- Instagram URL -->
                    <div class="mb-3">
                        <label for="contactInstagram" class="form-label">Instagram (URL)</label>
                        <input type="text" class="form-control" id="contactInstagram" name="contact[social][instagram]" value="{{ data.contact.social.instagram }}">
                    </div>
                </div>

            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
            </div>
        </form>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="statusModal" tabindex="-1" aria-labelledby="statusModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="statusModalLabel">Status operacji</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <p id="statusMessage"></p>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zamknij</button>
            </div>
        </div>
        </div>
    </div>
  
    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form'); // Zakładam, że masz formularz na stronie

            form.addEventListener('submit', function(event) {
                event.preventDefault(); // Zatrzymanie domyślnego działania formularza

                const formData = new FormData(form);
                
                // Wysłanie danych AJAX do serwera
                fetch(form.action, {
                    method: 'POST',
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    // Sprawdzenie, czy operacja się powiodła
                    const statusMessage = document.getElementById('statusMessage');
                    if (data.success) {
                        statusMessage.textContent = data.message;
                    } else {
                        statusMessage.textContent = `Błąd: ${data.message}`;
                    }
                    // Wywołanie modala
                    const statusModal = new bootstrap.Modal(document.getElementById('statusModal'));
                    statusModal.show();
                })
                .catch(error => {
                    // Obsługa błędów po stronie klienta
                    const statusMessage = document.getElementById('statusMessage');
                    statusMessage.textContent = `Błąd: ${error}`;
                    const statusModal = new bootstrap.Modal(document.getElementById('statusModal'));
                    statusModal.show();
                });
            });
        });

        function addClient() {
            const clientList = document.getElementById('clients-list');
            const newClientIndex = clientList.children.length;
            const clientItem = document.createElement('div');
            clientItem.classList.add('mb-3', 'client-item');
            clientItem.innerHTML = `
                <label for="client${newClientIndex}" class="form-label">Logo Klienta ${newClientIndex + 1} (URL)</label>
                <input type="text" class="form-control" id="client${newClientIndex}" name="clients[${newClientIndex}]">
                <button type="button" class="remove-btn" onclick="removeClient(this)">Usuń</button>
            `;
            clientList.appendChild(clientItem);
        }

        function removeClient(button) {
            const clientItem = button.closest('.client-item');
            clientItem.remove();
        }

        let currentPage = 1;

        document.addEventListener('DOMContentLoaded', () => {
            loadTestimonials(currentPage);
        });

        function loadTestimonials(page) {
            fetch(`/profile/pages/opinie?page=${page}`)
                .then(response => response.json())
                .then(data => {
                    const testimonialsList = document.getElementById('testimonials-list');
                    testimonialsList.innerHTML = ''; // Wyczyszczenie obecnych opinii
                    data.testimonials.forEach(testimonial => {
                        testimonialsList.innerHTML += `
                            <div class="testimonial-item mb-4">
                                <h3>Opinia</h3>
                                <div class="mb-3">
                                    <label class="form-label">Zdjęcie (URL)</label>
                                    <input type="text" class="form-control" value="${testimonial.photo}">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Autor</label>
                                    <input type="text" class="form-control" value="${testimonial.author}">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Zawód</label>
                                    <input type="text" class="form-control" value="${testimonial.occupation}">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Cytat</label>
                                    <textarea class="form-control" rows="3">${testimonial.quote}</textarea>
                                </div>
                            </div>`;
                    });

                    // Aktualizacja paginacji
                    document.getElementById('pagination-info').textContent = `Strona ${data.pagination.current_page} z ${data.pagination.total_pages}`;
                    document.getElementById('prevPage').style.display = data.pagination.has_prev ? 'block' : 'none';
                    document.getElementById('nextPage').style.display = data.pagination.has_next ? 'block' : 'none';
                });
        }

        function changePage(direction) {
            currentPage += direction;
            loadTestimonials(currentPage);
        }

        function addTestimonial() {
            const formData = new FormData();
            formData.append('photo', '');
            formData.append('author', '');
            formData.append('occupation', '');
            formData.append('quote', '');
            formData.append('facebook', '');
            formData.append('linkedin', '');
            formData.append('google', '');

            fetch('/profile/pages/opinie/add', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text()) // Zamiast .json(), użyj .text() aby zobaczyć co dokładnie zwraca serwer
            .then(text => {
                console.log("Odpowiedź serwera:", text);
                const data = JSON.parse(text); // Jeśli to jest poprawny JSON, parsowanie zadziała.
                if (data.success) {
                    alert(data.message);
                    loadTestimonials(currentPage);  // Odświeżenie listy opinii
                } else {
                    alert(data.message);
                }
            })
            .catch(error => console.error('Błąd:', error));
        }

        function removeTestimonial(index) {
            if (confirm('Czy na pewno chcesz usunąć tę opinię?')) {
                fetch(`/profile/pages/opinie/remove/${index}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(data.message);
                        loadTestimonials(currentPage);  // Odświeżenie listy opinii
                    } else {
                        alert(data.message);
                    }
                })
                .catch(error => console.error('Błąd:', error));
            }
        }

        function addAboutUsPoint() {
            const aboutUsPointsList = document.getElementById('aboutUsPointsList');
            const newPointIndex = aboutUsPointsList.children.length;
            const pointItem = document.createElement('div');
            pointItem.classList.add('mb-3', 'about-us-point-item');
            pointItem.innerHTML = `
                <label for="aboutUsPoint${newPointIndex}" class="form-label">Punkt ${newPointIndex + 1}</label>
                <input type="text" class="form-control" id="aboutUsPoint${newPointIndex}" name="aboutUs[points][${newPointIndex}]">
                <button type="button" class="remove-btn" onclick="removeAboutUsPoint(this)">Usuń</button>
            `;
            aboutUsPointsList.appendChild(pointItem);
        }

        function removeAboutUsPoint(button) {
            const pointItem = button.closest('.about-us-point-item');
            pointItem.remove();
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
</body>
</html>
